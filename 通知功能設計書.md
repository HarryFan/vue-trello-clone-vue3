# 📣 Trello Clone 通知功能設計書

## 1. 目標
當任務卡片（Card）接近截止時間（deadline）時，透過瀏覽器通知（Notification API）即時提醒使用者處理任務。

---

## 2. 後端 API 設計建議

### 2.1 Card 物件新增 `deadline` 欄位
| 欄位名稱 | 資料型別 | 說明 |
| -------- | -------- | ---- |
| `deadline` | `DATETIME` | 任務卡片的到期時間，前端用來排程通知。 |

### 2.2 回傳資料結構
以下 API 的 **每個** Card 物件都必須帶上 `deadline`：

- `GET /api/lists/{listId}/cards`
- `GET /api/cards/{id}`

```jsonc
{
  "id": 123,
  "title": "筆記 API 規格",
  "deadline": "2025-05-02T14:30:00Z",
  ...
}
```

### 2.3 建立與更新
| 動作 | API | 備註 |
| ---- | --- | ---- |
| **新增卡片** | `POST /api/lists/{listId}/cards` | `deadline` 為選填，可為 `null` |
| **更新卡片** | `PUT /api/cards/{id}` | 同上 |

---

## 3. 前端 Notification API 使用

### 3.1 權限申請
```js
Notification.requestPermission().then(permission => {
  if (permission === 'granted') {
    console.log('✅ 已取得通知權限');
  }
});
```

### 3.2 本地通知排程
```js
const now = Date.now();
const deadlineTime = new Date(card.deadline).getTime();

if (deadlineTime > now) {
  setTimeout(() => {
    new Notification('任務到期提醒', {
      body: `卡片：「${card.title}」即將到期！`,
      icon: '/icons/notification.png'
    });
  }, deadlineTime - now); // 剩餘毫秒數
}
```

### 3.3 通知範例
```js
new Notification('任務到期提醒', {
  body: '卡片：「筆記 API 規格」即將到期！',
  icon: '/icons/notification.png'
});
```

---

## 4. 實作注意事項
1. **使用者授權**：此功能仰賴使用者允許瀏覽器通知，若拒絕則無法顯示提醒。
2. **前端自行倒數**：透過 `setTimeout` 於用戶端計算剩餘時間，不需後端定期推播。
3. **UX 建議**：可在截止前 **10 分鐘** 即發送通知，提高使用者反應時間。
4. **進階背景推播（可選）**：若需離線或背景通知，可整合 Firebase Cloud Messaging（FCM），藉由 Service Worker 實現。

---

> **Tips for Vue 前端：**
> - 在 `mounted` 生命週期內批次抓卡片資料並排程通知。
> - 使用 `Vue.use()` 註冊全域通知服務，方便任意組件呼叫。
> - 若專案採用 PWA，可再配合 Service Worker 完成更進階的背景通知。
